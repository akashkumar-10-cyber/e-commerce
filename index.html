<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ElectroVault — Demo Store</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/a2d9b7f6c6.js" crossorigin="anonymous"></script>

  <style>
    /* E-commerce themed styles */
    :root{
      --brand:#0d6efd;
      --accent:#0b5ed7;
      --card-shadow: 0 6px 18px rgba(13,110,253,0.08);
    }
    body{ background: linear-gradient(180deg,#f6f8fb 0%, #ffffff 100%); }
    .topbar{ background:linear-gradient(90deg,var(--brand),var(--accent)); color:#fff; }
    .brand{ font-weight:700; letter-spacing:.2px; }
    .product-img{ height:200px; object-fit:cover; }
    .card{ border:0; border-radius:12px; box-shadow: var(--card-shadow); }
    .price-badge{ background:rgba(13,110,253,0.08); color:var(--brand); padding:6px 8px; border-radius:8px; font-weight:600; }
    .cta-primary{ background:var(--brand); color:#fff; border:none; }
    .cta-primary:hover{ background:var(--accent); }
    .small-muted{ color:#6c757d; font-size:.85rem; }
    /* header icons */
    .nav-icon{ color:#fff; opacity:.95; margin-left:8px; }
    /* layout */
    #mainContainer{ padding-top:22px; padding-bottom:60px; }
    .sidebar-card{ border-radius:12px; padding:14px; background:#fff; box-shadow:var(--card-shadow); }
    footer{ padding:24px 0; color:#6c757d; }
    /* responsive fixes */
    @media (max-width:576px){
      .product-img{ height:150px; }
    }
  </style>
</head>
<body>

  <!-- Topbar -->
  <nav class="navbar topbar navbar-expand-lg py-2">
    <div class="container">
      <a class="navbar-brand text-white brand" href="#"><i class="fa-solid fa-bolt"></i> ElectroVault</a>

      <div class="d-flex align-items-center ms-auto">
        <div id="authArea" class="me-3"></div>

        <button class="btn btn-transparent nav-icon position-relative me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas" aria-controls="cartOffcanvas" title="Cart">
          <i class="fa-solid fa-cart-shopping fa-lg"></i>
          <span id="cartCount" class="badge bg-danger rounded-pill" style="position:absolute; top:-6px; right:-8px; font-size:.7rem;">0</span>
        </button>

        <button class="btn btn-transparent nav-icon position-relative me-2" type="button" data-bs-toggle="modal" data-bs-target="#wishlistModal" title="Wishlist">
          <i class="fa-regular fa-heart fa-lg"></i>
          <span id="wishCount" class="badge bg-warning text-dark rounded-pill" style="position:absolute; top:-6px; right:-8px; font-size:.7rem;">0</span>
        </button>

        <button class="btn btn-light btn-sm ms-2" data-bs-toggle="modal" data-bs-target="#authModal"><i class="fa-solid fa-user"></i> Login</button>
      </div>
    </div>
  </nav>

  <!-- Hero / search -->
  <section class="py-4">
    <div class="container">
      <div class="row g-3 align-items-center">
        <div class="col-md-8">
          <div class="input-group shadow-sm">
            <span class="input-group-text"><i class="fa-solid fa-magnifying-glass"></i></span>
            <input id="searchInput" class="form-control" placeholder="Search products, brands, categories..." />
            <select id="sortSelect" class="form-select" style="max-width:160px;">
              <option value="default">Sort: Popular</option>
              <option value="low">Price: Low → High</option>
              <option value="high">Price: High → Low</option>
            </select>
          </div>
        </div>

        <div class="col-md-4 text-md-end">
          <div class="d-inline-block me-2">
            <span class="small-muted">Free shipping over ₹2000</span>
          </div>
          <a href="#ordersSection" class="btn btn-outline-light btn-sm" style="border-color:rgba(255,255,255,0.15);">My Orders</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Main content -->
  <main id="mainContainer" class="container">
    <div class="row g-4">

      <!-- left: products -->
      <div class="col-lg-8">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h4 class="mb-0">Top Picks</h4>
          <small class="small-muted">Best deals for you</small>
        </div>

        <div id="productGrid" class="row gy-4">
          <!-- products inserted here -->
        </div>
      </div>

      <!-- right: sidebar -->
      <aside class="col-lg-4">
        <div class="sidebar-card mb-4">
          <h6>Cart Summary</h6>
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div class="small-muted">Items in cart</div>
            <div><strong id="cartCountSidebar">0</strong></div>
          </div>
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div class="small-muted">Estimated total</div>
            <div class="price-badge" id="sidebarEstimate">₹0</div>
          </div>
          <div class="d-grid">
            <button class="btn cta-primary" data-bs-toggle="offcanvas" data-bs-target="#cartOffcanvas">View Cart & Checkout</button>
          </div>
        </div>

        <div class="sidebar-card mb-4">
          <h6>Write a review</h6>
          <form id="reviewForm">
            <div class="mb-2">
              <textarea id="reviewText" class="form-control" rows="3" placeholder="Share your experience..."></textarea>
            </div>
            <div class="d-grid">
              <button class="btn btn-outline-primary" type="submit">Submit Review</button>
            </div>
          </form>
        </div>

        <div class="sidebar-card">
          <h6>Report an issue</h6>
          <form id="reportForm">
            <div class="mb-2"><input id="repName" class="form-control" placeholder="Name" /></div>
            <div class="mb-2"><input id="repEmail" class="form-control" placeholder="Email" /></div>
            <div class="mb-2">
              <select id="repType" class="form-select">
                <option value="">Choose type</option>
                <option value="product">Product issue</option>
                <option value="order">Order issue</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="mb-2"><textarea id="repMsg" class="form-control" rows="2" placeholder="Message"></textarea></div>
            <div class="d-grid">
              <button class="btn btn-outline-danger" type="submit">Submit Report</button>
            </div>
            <div id="repStatus" class="mt-2 small text-success"></div>
          </form>
        </div>
      </aside>

      <!-- Reviews & Orders row -->
      <div class="col-12 mt-2">
        <div class="row g-3">
          <div class="col-md-6">
            <div class="sidebar-card">
              <h6 class="mb-3">Latest Reviews</h6>
              <ul id="reviewList" class="list-group list-group-flush">
                <!-- reviews -->
              </ul>
            </div>
          </div>
          <div class="col-md-6" id="ordersSection">
            <div class="sidebar-card">
              <h6 class="mb-3">Orders & Wishlist</h6>
              <ul id="orderList" class="list-group list-group-flush mb-3"></ul>
              <h6 class="mb-2">Wishlist</h6>
              <ul id="wishListView" class="list-group list-group-flush"></ul>
            </div>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="mt-5">
    <div class="container">
      <div class="d-flex justify-content-between align-items-center">
        <div>© <strong>ElectroVault</strong> — Demo store</div>
        <div class="small-muted">Built with ❤️ • LocalStorage demo</div>
      </div>
    </div>
  </footer>

  <!-- Cart Offcanvas -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="cartOffcanvas" aria-labelledby="cartOffcanvasLabel">
    <div class="offcanvas-header">
      <h5 id="cartOffcanvasLabel">Your Cart</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
      <ul id="cartList" class="list-group mb-3"></ul>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="small-muted">Total</div>
        <div id="cartTotal" class="h5">₹0</div>
      </div>
      <div class="d-grid">
        <button id="placeOrderBtn" class="btn btn-primary">Place Order</button>
      </div>
    </div>
  </div>

  <!-- Wishlist Modal -->
  <div class="modal fade" id="wishlistModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Your Wishlist</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <ul id="wishListViewModal" class="list-group"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth Modal (Login/Register) -->
  <div class="modal fade" id="authModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Account</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <ul class="nav nav-tabs mb-3" id="authTabs" role="tablist">
            <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-target="#loginTab" data-bs-toggle="tab">Login</button></li>
            <li class="nav-item" role="presentation"><button class="nav-link" data-bs-target="#registerTab" data-bs-toggle="tab">Register</button></li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane active" id="loginTab">
              <form id="loginForm">
                <div class="mb-2"><input id="loginEmail" type="email" class="form-control" placeholder="Email" required></div>
                <div class="mb-2"><input id="loginPassword" type="password" class="form-control" placeholder="Password" required></div>
                <div class="d-grid"><button class="btn btn-primary" type="submit">Login</button></div>
              </form>
            </div>
            <div class="tab-pane" id="registerTab">
              <form id="registerForm">
                <div class="mb-2"><input id="regName" class="form-control" placeholder="Full name" required></div>
                <div class="mb-2"><input id="regEmail" type="email" class="form-control" placeholder="Email" required></div>
                <div class="mb-2"><input id="regPassword" type="password" class="form-control" placeholder="Password (min 6 chars)" required></div>
                <div class="d-grid"><button class="btn btn-outline-primary" type="submit">Register & Login</button></div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast container (for fallback) -->
  <div id="toastRoot" aria-live="polite" aria-atomic="true"></div>

  <!-- Script: Bootstrap + app JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
  // ---------- data + localStorage ----------
  const PRODUCTS = [
    { id: 'p1', title: 'Wireless Headphones', price: 1999, img: 'https://via.placeholder.com/400x300?text=Headphones' },
    { id: 'p2', title: 'Smart Watch', price: 2999, img: 'https://via.placeholder.com/400x300?text=Smart+Watch' },
    { id: 'p3', title: 'Bluetooth Speaker', price: 1499, img: 'https://via.placeholder.com/400x300?text=Speaker' },
    { id: 'p4', title: 'Portable Charger', price: 899, img: 'https://via.placeholder.com/400x300?text=Charger' },
    { id: 'p5', title: 'Webcam', price: 2599, img: 'https://via.placeholder.com/400x300?text=Webcam' },
  ];

  const LS = {
    get(key){ try { return JSON.parse(localStorage.getItem(key)); } catch(e){return null} },
    set(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
  };

  // initialize app state on first run
  if (!LS.get('users')) LS.set('users', []);      // array {name,email,password}
  if (!LS.get('session')) LS.set('session', null); // email of logged in user
  if (!LS.get('cart')) LS.set('cart', []);       // array {email,items:[{productId,qty}]}
  if (!LS.get('wishlist')) LS.set('wishlist', []); // array {email,productId}
  if (!LS.get('orders')) LS.set('orders', []);    // array {email,order}
  if (!LS.get('reviews')) LS.set('reviews', []);  // array {name,text,date}
  if (!LS.get('reports')) LS.set('reports', []);  // array {name,email,type,msg,date}

  // utilities
  const qs = sel => document.querySelector(sel);
  const qsa = sel => Array.from(document.querySelectorAll(sel));

  /* ---------- UI Rendering ---------- */

  function renderProducts(sort='default'){
    const grid = qs('#productGrid');
    if (!grid) return;
    grid.innerHTML = '';
    let list = [...PRODUCTS];
    if (sort === 'low') list.sort((a,b)=>a.price-b.price);
    if (sort === 'high') list.sort((a,b)=>b.price-a.price);

    list.forEach(p=>{
      const col = document.createElement('div');
      col.className = 'col-sm-6 col-md-4';
      col.innerHTML = \`
        <div class="card h-100 shadow-sm">
          <img src="\${p.img}" class="product-img card-img-top" alt="\${p.title}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">\${p.title}</h5>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="price-badge">₹\${p.price.toLocaleString()}</div>
              <div class="small-muted">In stock</div>
            </div>
            <div class="mt-auto d-flex gap-2">
              <button class="btn btn-outline-primary btn-sm w-100 add-cart" data-id="\${p.id}">
                <i class="fa-solid fa-cart-plus"></i> Add to cart
              </button>
              <button class="btn btn-outline-danger btn-sm add-wish" data-id="\${p.id}" title="Add to wishlist">
                <i class="fa-regular fa-heart"></i>
              </button>
            </div>
          </div>
        </div>\`;
      grid.appendChild(col);
    });

    // attach handlers
    qsa('.add-cart').forEach(b=>b.addEventListener('click', e=>{
      const id = e.currentTarget.dataset.id;
      addToCart(id);
    }));
    qsa('.add-wish').forEach(b=>b.addEventListener('click', e=>{
      const id = e.currentTarget.dataset.id;
      toggleWishlist(id);
    }));
  }

  function updateCounts(){
    const session = LS.get('session');
    let cart = LS.get('cart') || [];
    let wishlist = LS.get('wishlist') || [];

    const email = session;
    const userCart = email ? (cart.find(c=>c.email===email)?.items||[]) : [];
    const count = userCart.reduce((s,i)=>s+i.qty,0);
    const cartCountEl = qs('#cartCount');
    if (cartCountEl) cartCountEl.textContent = count;

    const cartCountSidebar = qs('#cartCountSidebar');
    if (cartCountSidebar) cartCountSidebar.textContent = count;

    const estimate = userCart.reduce((s,i) => s + (PRODUCTS.find(p=>p.id===i.productId)?.price || 0) * i.qty, 0);
    const sidebarEstimate = qs('#sidebarEstimate');
    if (sidebarEstimate) sidebarEstimate.textContent = '₹' + estimate.toLocaleString();

    const wishCount = email ? wishlist.filter(w=>w.email===email).length : 0;
    const wishCountEl = qs('#wishCount');
    if (wishCountEl) wishCountEl.textContent = wishCount;

    renderAuthArea();
    renderCart();
    renderOrders();
    renderWishlistView();
    renderReviews();
  }

  function renderAuthArea(){
    const session = LS.get('session');
    const authArea = qs('#authArea');
    if (!authArea) return;

    if (session){
      const users = LS.get('users')||[];
      const user = users.find(u=>u.email===session);
      authArea.innerHTML = \`
        <div class="btn-group">
          <button class="btn btn-light btn-sm dropdown-toggle" data-bs-toggle="dropdown">
            <i class="fa-solid fa-user"></i> \${user ? user.name.split(' ')[0] : 'User'}
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#ordersSection" id="viewOrdersLink">Orders & Wishlist</a></li>
            <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
          </ul>
        </div>\`;
      const logoutBtn = qs('#logoutBtn');
      if (logoutBtn) logoutBtn.addEventListener('click', (e)=>{
        e.preventDefault();
        LS.set('session', null);
        updateCounts();
        showToast('Logged out');
      });
    } else {
      authArea.innerHTML = \`<button id="openLogin" class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#authModal">Login / Register</button>\`;
      const btn = qs('#openLogin');
      if (btn) btn.addEventListener('click', ()=>{/* modal handled by bootstrap */});
    }
  }

  /* ---------- CART / WISHLIST / ORDERS ---------- */

  function addToCart(productId, qty=1){
    const session = LS.get('session');
    if (!session){
      const modalEl = document.getElementById('authModal');
      if (modalEl && typeof bootstrap !== 'undefined'){
        const modal = new bootstrap.Modal(modalEl);
        modal.show();
      } else {
        alert('Please login to add items to cart.');
      }
      return;
    }
    let cart = LS.get('cart') || [];
    let entry = cart.find(c=>c.email===session);
    if (!entry){ entry = { email: session, items: []}; cart.push(entry); }
    const item = entry.items.find(x=>x.productId===productId);
    if (item) item.qty += qty; else entry.items.push({ productId, qty });
    LS.set('cart', cart);
    updateCounts();
    showToast('Added to cart');
  }

  function renderCart(){
    const session = LS.get('session');
    const cartList = qs('#cartList');
    if (!cartList) return;
    cartList.innerHTML = '';
    let total = 0;
    if (!session) { cartList.innerHTML = '<li class="list-group-item">Your cart is empty. Login to add items.</li>'; const ct = qs('#cartTotal'); if (ct) ct.textContent='₹0'; return; }
    const cart = LS.get('cart') || [];
    const entry = cart.find(c=>c.email===session);
    if (!entry || entry.items.length===0) { cartList.innerHTML = '<li class="list-group-item">Cart is empty</li>'; const ct = qs('#cartTotal'); if (ct) ct.textContent='₹0'; return; }

    entry.items.forEach(i=>{
      const p = PRODUCTS.find(x=>x.id===i.productId);
      if (!p) return;
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = \`
        <div>
          <div class="small text-muted">\${p.title}</div>
          <div>₹\${p.price.toLocaleString()} × \${i.qty}</div>
        </div>
        <div class="btn-group btn-group-sm">
          <button class="btn btn-outline-secondary me-1 dec-item" data-id="\${p.id}">-</button>
          <button class="btn btn-outline-secondary inc-item" data-id="\${p.id}">+</button>
          <button class="btn btn-outline-danger remove-item" data-id="\${p.id}"><i class="fa-solid fa-trash"></i></button>
        </div>\`;
      cartList.appendChild(li);
      total += p.price * i.qty;
    });

    const cartTotalEl = qs('#cartTotal');
    if (cartTotalEl) cartTotalEl.textContent = \`₹\${total.toLocaleString()}\`;

    qsa('.inc-item').forEach(b=>b.addEventListener('click', e=>{
      changeQty(e.currentTarget.dataset.id, +1);
    }));
    qsa('.dec-item').forEach(b=>b.addEventListener('click', e=>{
      changeQty(e.currentTarget.dataset.id, -1);
    }));
    qsa('.remove-item').forEach(b=>b.addEventListener('click', e=>{
      removeFromCart(e.currentTarget.dataset.id);
    }));
  }

  function changeQty(pid, delta){
    const session = LS.get('session');
    if (!session) return;
    let cart = LS.get('cart') || [];
    const entry = cart.find(c=>c.email===session);
    if (!entry) return;
    const item = entry.items.find(i=>i.productId===pid);
    if (!item) return;
    item.qty += delta;
    if (item.qty <= 0) entry.items = entry.items.filter(i=>i.productId!==pid);
    LS.set('cart', cart);
    renderCart();
    updateCounts();
  }

  function removeFromCart(pid){
    const session = LS.get('session');
    let cart = LS.get('cart') || [];
    const entry = cart.find(c=>c.email===session);
    if (!entry) return;
    entry.items = entry.items.filter(i=>i.productId!==pid);
    LS.set('cart', cart);
    renderCart(); updateCounts();
  }

  qs('#placeOrderBtn')?.addEventListener('click', ()=>{
    const session = LS.get('session');
    if (!session) return alert('Please login to place order.');
    let cart = LS.get('cart') || [];
    const entry = cart.find(c=>c.email===session);
    if (!entry || entry.items.length===0) return alert('Cart is empty.');
    const orders = LS.get('orders') || [];
    const order = {
      id: 'ord_' + Date.now(),
      items: entry.items,
      total: entry.items.reduce((s,i)=> s + (PRODUCTS.find(p=>p.id===i.productId)?.price || 0) * i.qty, 0),
      date: new Date().toISOString()
    };
    orders.push({ email: session, order });
    LS.set('orders', orders);
    // clear user's cart
    entry.items = [];
    LS.set('cart', cart);
    renderCart(); updateCounts(); renderOrders();
    showToast('Order placed successfully');
  });

  /* Wishlist */
  function toggleWishlist(productId){
    const session = LS.get('session');
    if (!session) {
      const modalEl = document.getElementById('authModal');
      if (modalEl && typeof bootstrap !== 'undefined'){
        new bootstrap.Modal(modalEl).show();
      } else {
        alert('Please login to use wishlist.');
      }
      return;
    }
    let wishlist = LS.get('wishlist') || [];
    const exists = wishlist.find(w=>w.email===session && w.productId===productId);
    if (exists) {
      wishlist = wishlist.filter(w=> !(w.email===session && w.productId===productId) );
      showToast('Removed from wishlist');
    } else {
      wishlist.push({ email: session, productId });
      showToast('Added to wishlist');
    }
    LS.set('wishlist', wishlist);
    updateCounts(); renderWishlistView();
  }

  function renderWishlistView(){
    const list = qs('#wishListView');
    const listModal = qs('#wishListViewModal');
    if (list) list.innerHTML = '';
    if (listModal) listModal.innerHTML = '';
    const session = LS.get('session');
    if (!session){
      if (list) list.innerHTML = '<li class="list-group-item">Login to see wishlist.</li>';
      if (listModal) listModal.innerHTML = '<li class="list-group-item">Login to see wishlist.</li>';
      return;
    }
    const wishlist = LS.get('wishlist') || [];
    const items = wishlist.filter(w=>w.email===session);
    if (items.length===0) {
      if (list) list.innerHTML = '<li class="list-group-item">Your wishlist is empty.</li>';
      if (listModal) listModal.innerHTML = '<li class="list-group-item">Your wishlist is empty.</li>';
      return;
    }
    items.forEach(w=>{
      const p = PRODUCTS.find(pp=>pp.id===w.productId);
      if (!p) return;
      const li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = \`<div>\${p.title}<div class="small text-muted">₹\${p.price.toLocaleString()}</div></div>
        <div>
          <button class="btn btn-sm btn-primary add-cart-from-wish" data-id="\${p.id}">Add to cart</button>
          <button class="btn btn-sm btn-danger remove-wish" data-id="\${p.id}"><i class="fa-solid fa-trash"></i></button>
        </div>\`;
      if (list) list.appendChild(li);
      if (listModal) {
        const li2 = li.cloneNode(true);
        listModal.appendChild(li2);
      }
    });

    qsa('.add-cart-from-wish').forEach(b=>b.addEventListener('click', e=>{
      addToCart(e.currentTarget.dataset.id,1);
    }));
    qsa('.remove-wish').forEach(b=>b.addEventListener('click', e=>{
      const id = e.currentTarget.dataset.id;
      let wishlist = LS.get('wishlist') || [];
      const session = LS.get('session');
      wishlist = wishlist.filter(w => !(w.productId===id && w.email===session));
      LS.set('wishlist', wishlist);
      updateCounts(); renderWishlistView();
    }));
  }

  /* Orders */
  function renderOrders(){
    const el = qs('#orderList');
    if (!el) return;
    el.innerHTML = '';
    const session = LS.get('session');
    if (!session){ el.innerHTML = '<li class="list-group-item">Login to view orders.</li>'; return; }
    const orders = LS.get('orders') || [];
    const my = orders.filter(o=>o.email===session);
    if (my.length===0) { el.innerHTML = '<li class="list-group-item">No orders yet.</li>'; return; }
    my.forEach(o=>{
      const li = document.createElement('li');
      li.className = 'list-group-item';
      li.innerHTML = \`<div class="d-flex justify-content-between"><div>Order <strong>\${o.order.id}</strong></div><div>\${new Date(o.order.date).toLocaleString()}</div></div>
        <div class="small text-muted">Items: \${o.order.items.length} — Total ₹\${o.order.total.toLocaleString()}</div>\`;
      el.appendChild(li);
    });
  }

  /* Reviews */
  qs('#reviewForm')?.addEventListener('submit', (ev)=>{
    ev.preventDefault();
    const txtEl = qs('#reviewText');
    const txt = txtEl ? txtEl.value.trim() : '';
    if (!txt) return alert('Write something first.');
    const reviews = LS.get('reviews') || [];
    const name = LS.get('session') ? (LS.get('users')||[]).find(u=>u.email===LS.get('session')).name : 'Guest';
    reviews.unshift({ name, text: txt, date: new Date().toISOString() });
    LS.set('reviews', reviews);
    if (txtEl) txtEl.value = '';
    renderReviews();
    showToast('Thanks for your review!');
  });

  function renderReviews(){
    const list = qs('#reviewList');
    if (!list) return;
    list.innerHTML = '';
    const reviews = LS.get('reviews') || [];
    reviews.slice(0,10).forEach(r=>{
      const li = document.createElement('li');
      li.className = 'list-group-item';
      li.innerHTML = \`<strong>\${r.name}</strong> <div class="small text-muted">\${new Date(r.date).toLocaleString()}</div><p class="mb-0">\${r.text}</p>\`;
      list.appendChild(li);
    });
  }

  /* Reports */
  qs('#reportForm')?.addEventListener('submit', (ev)=>{
    ev.preventDefault();
    const name = qs('#repName')?.value.trim() || '';
    const email = qs('#repEmail')?.value.trim() || '';
    const type = qs('#repType')?.value || '';
    const msg = qs('#repMsg')?.value.trim() || '';
    if (!name || !email || !type || !msg) return alert('Please fill all fields.');
    const reports = LS.get('reports') || [];
    reports.push({ name, email, type, msg, date: new Date().toISOString() });
    LS.set('reports', reports);
    const status = qs('#repStatus');
    if (status) status.textContent = 'Report submitted — our team will contact you.';
    setTimeout(()=> { if (status) status.textContent = ''; }, 4000);
    if (qs('#repName')) qs('#repName').value='';
    if (qs('#repEmail')) qs('#repEmail').value='';
    if (qs('#repMsg')) qs('#repMsg').value='';
    if (qs('#repType')) qs('#repType').value='';
  });

  /* ---------- AUTH (Register / Login) ---------- */

  qs('#registerForm')?.addEventListener('submit', (ev)=>{
    ev.preventDefault();
    const name = qs('#regName')?.value.trim() || '';
    const email = qs('#regEmail')?.value.trim().toLowerCase() || '';
    const password = qs('#regPassword')?.value || '';
    if (!name || !email || !password) return alert('Fill all fields.');
    if (password.length < 6) return alert('Password must be at least 6 characters.');
    let users = LS.get('users') || [];
    if (users.find(u=>u.email === email)) return alert('Email already registered. Please login.');
    users.push({ name, email, password });
    LS.set('users', users);
    LS.set('session', email); // auto login
    const modalEl = document.getElementById('authModal');
    if (modalEl && typeof bootstrap !== 'undefined') {
      bootstrap.Modal.getInstance(modalEl)?.hide();
    }
    renderAuthArea();
    updateCounts();
    qs('#registerForm')?.reset();
    showToast('Registration successful — you are logged in.');
  });

  qs('#loginForm')?.addEventListener('submit', (ev)=>{
    ev.preventDefault();
    const email = qs('#loginEmail')?.value.trim().toLowerCase() || '';
    const password = qs('#loginPassword')?.value || '';
    const users = LS.get('users') || [];
    const user = users.find(u=>u.email===email && u.password===password);
    if (!user) return alert('Invalid credentials.');
    LS.set('session', email);
    const modalEl = document.getElementById('authModal');
    if (modalEl && typeof bootstrap !== 'undefined') {
      bootstrap.Modal.getInstance(modalEl)?.hide();
    }
    renderAuthArea();
    updateCounts();
    qs('#loginForm')?.reset();
    showToast('Logged in successfully.');
  });

  /* ---------- tiny toast (simple) ---------- */
  function showToast(msg){
    try {
      const toast = document.createElement('div');
      toast.className = 'toast align-items-center text-bg-dark border-0 show';
      toast.style.position = 'fixed';
      toast.style.right = '18px';
      toast.style.bottom = '18px';
      toast.style.zIndex = 9999;
      toast.innerHTML = \`<div class="d-flex"><div class="toast-body">\${msg}</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" aria-label="Close"></button></div>\`;
      document.body.appendChild(toast);
      toast.querySelector('.btn-close').addEventListener('click', ()=> toast.remove());
      setTimeout(()=> toast.remove(), 2200);
    } catch(e){
      alert(msg);
    }
  }

  /* interactions */
  qs('#sortSelect')?.addEventListener('change', (e)=> renderProducts(e.target.value));
  qs('#searchInput')?.addEventListener('input', (e)=>{
    const q = e.target.value.trim().toLowerCase();
    // quick client-side filter: re-render matching products
    if (!q) { renderProducts(qs('#sortSelect')?.value || 'default'); return; }
    const filtered = PRODUCTS.filter(p => p.title.toLowerCase().includes(q));
    const grid = qs('#productGrid');
    if (!grid) return;
    grid.innerHTML = '';
    filtered.forEach(p=>{
      const col = document.createElement('div');
      col.className = 'col-sm-6 col-md-4';
      col.innerHTML = \`
        <div class="card h-100 shadow-sm">
          <img src="\${p.img}" class="product-img card-img-top" alt="\${p.title}">
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">\${p.title}</h5>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <div class="price-badge">₹\${p.price.toLocaleString()}</div>
              <div class="small-muted">In stock</div>
            </div>
            <div class="mt-auto d-flex gap-2">
              <button class="btn btn-outline-primary btn-sm w-100 add-cart" data-id="\${p.id}">
                <i class="fa-solid fa-cart-plus"></i> Add to cart
              </button>
              <button class="btn btn-outline-danger btn-sm add-wish" data-id="\${p.id}" title="Add to wishlist">
                <i class="fa-regular fa-heart"></i>
              </button>
            </div>
          </div>
        </div>\`;
      grid.appendChild(col);
    });
    // attach handlers
    qsa('.add-cart').forEach(b=>b.addEventListener('click', e=> addToCart(e.currentTarget.dataset.id)));
    qsa('.add-wish').forEach(b=>b.addEventListener('click', e=> toggleWishlist(e.currentTarget.dataset.id)));
  });

  /* initial render */
  renderProducts();
  updateCounts();
  renderReviews();
  renderOrders();
  renderWishlistView();
  renderCart();
  </script>

</body>
</html>
